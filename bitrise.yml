workflows:
  unity-android-workflow:
    name: Unity Android Workflow
    instance_type: mac_pro
    max_build_duration: 120
    environment:
      vars:
        UNITY_VERSION: 2022.3.24f1
        UNITY_VERSION_CHANGESET: 334eb2a0b267
        BUILD_SCRIPT: PerformAndroidIOSBuild
      xcode: latest
    scripts:
      - name: Activate Unity License
        script: |  
          /Applications/Unity/Contents/MacOS/Unity -batchmode -quit -logFile -serial SC-Y6CX-XYJF-ZXXN-83MV-9B2F -username 's.c.apps@ivycomptech.com' -password 'Ivy@1234'
      - name: Install Unity version, build support modules, ndk and jdk
        script: |  
          /Applications/Unity\ Hub.app/Contents/MacOS/Unity\ Hub -- --headless install --version ${UNITY_VERSION} --changeset ${UNITY_VERSION_CHANGESET}
          /Applications/Unity\ Hub.app/Contents/MacOS/Unity\ Hub -- --headless install-modules --version ${UNITY_VERSION} -m android android-sdk-ndk-tools android-open-jdk          
      - name: Set build number and export Unity
        script: |
          Unity -quit -nographics -batchmode -serial SC-Y6CX-XYJF-ZXXN-83MV-9B2F -username 's.c.apps@ivycomptech.com' -password 'Ivy@1234' -projectPath /Users/vagrant/git/cicd_unity_sample -executeMethod JenkinsBuildHelper.$BUILD_SCRIPT release -buildTarget Android
    publishing:
      scripts:
        - name: Deactivate Unity License
          script: $UNITY_HOME/Contents/MacOS/Unity -batchmode -quit -returnlicense -nographics